image: docker

services:
    - docker:dind
    
stages:
    - test
    - deploy
    
test:
    stage: test
    only:
        - master
        - dev
    script:
        - apt-get install -y python-pip
        - pip install -r requirements.txt
        - python manage.py test
        
    
step-deploy-prod:
    stage: deploy
    only:
        - master
    script:
        - apt-get install -y python-pip
        - pip install docker-compos 
        - docker-compose up -d --build
    environment: master
    when: manual
            